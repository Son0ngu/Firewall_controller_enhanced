{# filepath: c:\Users\sonbx\firewall-controller\server\templates\dashboard.html #}
{% extends "base.html" %}

{% block title %}Dashboard - Firewall Controller{% endblock %}

{% block extra_css %}
<style>
    .status-card {
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    
    .status-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }
    
    .status-card .card-body {
        padding: 2rem;
    }
    
    .status-icon {
        font-size: 3rem;
        opacity: 0.3;
        transition: all 0.3s ease;
    }
    
    .status-card:hover .status-icon {
        opacity: 0.7;
        transform: scale(1.1);
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0;
        background: linear-gradient(45deg, #007bff, #0056b3);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .stat-label {
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 1rem;
    }
    
    .welcome-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 20px;
        overflow: hidden;
        position: relative;
    }
    
    .welcome-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="1" fill="white" opacity="0.1"/><circle cx="10" cy="90" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.1;
    }
    
    .welcome-card .card-body {
        position: relative;
        z-index: 1;
        padding: 3rem;
    }
    
    .quick-action-btn {
        background: rgba(255,255,255,0.1);
        border: 2px solid rgba(255,255,255,0.2);
        color: white;
        border-radius: 12px;
        padding: 1rem 1.5rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }
    
    .quick-action-btn:hover {
        background: rgba(255,255,255,0.2);
        border-color: rgba(255,255,255,0.4);
        color: white;
        transform: translateY(-2px);
    }
    
    .system-info-card {
        background: white;
        border: none;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    
    .info-item {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #007bff;
        transition: all 0.3s ease;
    }
    
    .info-item:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .info-item i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }
    
    .info-item h6 {
        font-weight: 700;
        color: #495057;
        margin-bottom: 0.5rem;
    }
    
    .info-item p {
        color: #6c757d;
        margin-bottom: 0;
        font-size: 0.9rem;
    }
    
    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 25px;
        padding: 4rem 2rem;
        text-align: center;
        color: white;
        margin-bottom: 3rem;
        position: relative;
        overflow: hidden;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
        background-size: 50px 50px;
        animation: float 20s infinite linear;
    }
    
    @keyframes float {
        0% { transform: translate(0, 0) rotate(0deg); }
        100% { transform: translate(-50px, -50px) rotate(360deg); }
    }
    
    .hero-content {
        position: relative;
        z-index: 1;
    }
    
    .pulse-dot {
        display: inline-block;
        width: 12px;
        height: 12px;
        background: #28a745;
        border-radius: 50%;
        margin-right: 8px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
        100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
    }
    
    .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
    }
    
    .feature-card {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        border: none;
    }
    
    .feature-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }
    
    .feature-icon {
        width: 70px;
        height: 70px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin-bottom: 1.5rem;
    }
    
    .feature-icon.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .feature-icon.success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
    .feature-icon.info { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .feature-icon.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="hero-content">
        <h1 class="display-4 fw-bold mb-4">
            <i class="fas fa-shield-alt me-3"></i>
            Firewall Controller
        </h1>
        <p class="lead mb-4">
            Advanced network security management with real-time monitoring and intelligent threat detection
        </p>
        <div class="d-flex justify-content-center align-items-center">
            <span class="pulse-dot"></span>
            <span class="fw-semibold">System Status: Active & Monitoring</span>
        </div>
    </div>
</div>

<!-- Status Cards -->
<div class="row mb-5">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card status-card border-start-primary">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="stat-label text-primary">
                            Total Logs
                        </div>
                        <div class="stat-number">
                            {{ stats.total_logs or 0 }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-clipboard-list status-icon text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card status-card border-start-success">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="stat-label text-success">
                            Allowed Requests
                        </div>
                        <div class="stat-number text-success">
                            {{ stats.allowed_count or 0 }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-check-circle status-icon text-success"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card status-card border-start-danger">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="stat-label text-danger">
                            Blocked Threats
                        </div>
                        <div class="stat-number text-danger">
                            {{ stats.blocked_count or 0 }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-shield-alt status-icon text-danger"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card status-card border-start-info">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="stat-label text-info">
                            Active Agents
                        </div>
                        <div class="stat-number text-info">
                            {{ stats.active_agents or 0 }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-laptop-code status-icon text-info"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Feature Cards -->
<div class="feature-grid">
    <!-- Quick Actions Card -->
    <div class="feature-card">
        <div class="feature-icon primary">
            <i class="fas fa-bolt"></i>
        </div>
        <h5 class="fw-bold mb-3">Quick Actions</h5>
        <p class="text-muted mb-4">Manage your firewall system with these essential tools</p>
        <div class="d-grid gap-2">
            <a href="/agents" class="btn btn-outline-primary">
                <i class="fas fa-desktop me-2"></i>Manage Agents
            </a>
            <a href="/whitelist" class="btn btn-outline-success">
                <i class="fas fa-list me-2"></i>Manage Whitelist
            </a>
            <a href="/logs" class="btn btn-outline-info">
                <i class="fas fa-file-alt me-2"></i>View Logs
            </a>
        </div>
    </div>

    <!-- System Information Card -->
    <div class="feature-card">
        <div class="feature-icon success">
            <i class="fas fa-server"></i>
        </div>
        <h5 class="fw-bold mb-3">System Information</h5>
        <p class="text-muted mb-4">Current system configuration and status</p>
        <div class="info-item">
            <i class="fas fa-code-branch text-primary"></i>
            <h6>Version</h6>
            <p>Firewall Controller v1.0.0</p>
        </div>
        <div class="info-item">
            <i class="fas fa-database text-success"></i>
            <h6>Database</h6>
            <p>MongoDB Connected</p>
        </div>
    </div>

    <!-- Security Status Card -->
    <div class="feature-card">
        <div class="feature-icon info">
            <i class="fas fa-shield-alt"></i>
        </div>
        <h5 class="fw-bold mb-3">Security Status</h5>
        <p class="text-muted mb-4">Real-time security monitoring and protection</p>
        <div class="info-item">
            <i class="fas fa-eye text-info"></i>
            <h6>Monitoring</h6>
            <p>Real-time traffic analysis active</p>
        </div>
        <div class="info-item">
            <i class="fas fa-bolt text-warning"></i>
            <h6>Real-time Updates</h6>
            <p>Socket.IO WebSocket connection</p>
        </div>
    </div>

    <!-- Performance Metrics Card -->
    <div class="feature-card">
        <div class="feature-icon warning">
            <i class="fas fa-chart-line"></i>
        </div>
        <h5 class="fw-bold mb-3">Performance Metrics</h5>
        <p class="text-muted mb-4">System performance and usage statistics</p>
        <div class="info-item">
            <i class="fas fa-tachometer-alt text-primary"></i>
            <h6>Response Time</h6>
            <p>< 50ms average response</p>
        </div>
        <div class="info-item">
            <i class="fas fa-memory text-success"></i>
            <h6>Memory Usage</h6>
            <p>Optimized for performance</p>
        </div>
    </div>
</div>

<!-- Modern Alert Section -->
<div class="row mt-5">
    <div class="col-12">
        <div class="alert alert-success d-flex align-items-center" role="alert" style="border: none; border-radius: 15px; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border-left: 5px solid #28a745;">
            <i class="fas fa-check-circle fa-2x me-3 text-success"></i>
            <div>
                <h6 class="alert-heading fw-bold mb-1">System Operational</h6>
                <p class="mb-0">All firewall components are running smoothly. Network protection is active and monitoring traffic in real-time.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Simple connection test
    try {
        const socket = io();
        
        socket.on('connect', function() {
            console.log(' Connected to server for real-time updates');
            
            // Update connection status indicator
            const statusDot = document.querySelector('.pulse-dot');
            if (statusDot) {
                statusDot.style.background = '#28a745';
            }
        });
        
        socket.on('disconnect', function() {
            console.log('âŒ Disconnected from server');
            
            // Update connection status indicator
            const statusDot = document.querySelector('.pulse-dot');
            if (statusDot) {
                statusDot.style.background = '#dc3545';
            }
        });
        
        //  Real-time statistics updates
        socket.on('stats_update', function(statsData) {
            // Update statistics in real-time
            updateDashboardStats(statsData);
        });
        
    } catch (error) {
        console.log('Socket.IO not available:', error);
    }
    
    // Function to update dashboard statistics
    function updateDashboardStats(stats) {
        const statElements = {
            'total_logs': document.querySelector('.stat-number'),
            'allowed_count': document.querySelectorAll('.stat-number')[1],
            'blocked_count': document.querySelectorAll('.stat-number')[2],
            'active_agents': document.querySelectorAll('.stat-number')[3]
        };
        
        Object.keys(statElements).forEach(key => {
            if (statElements[key] && stats[key] !== undefined) {
                // Animate number change
                animateNumber(statElements[key], parseInt(statElements[key].textContent), stats[key]);
            }
        });
    }
    
    // Animate number changes
    function animateNumber(element, start, end) {
        const duration = 1000;
        const startTime = performance.now();
        
        function update(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const current = Math.floor(start + (end - start) * progress);
            element.textContent = current.toLocaleString();
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        }
        
        requestAnimationFrame(update);
    }
    
    // Auto-refresh dashboard every 30 seconds
    setInterval(function() {
        // Refresh page data without full reload
        location.reload();
    }, 30000);
    
    // Add smooth scroll behavior
    document.addEventListener('DOMContentLoaded', function() {
        // Add entrance animations
        const cards = document.querySelectorAll('.status-card, .feature-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
</script>
{% endblock %}
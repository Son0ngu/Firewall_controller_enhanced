{% extends "base.html" %}

{% block title %}Domain Whitelist - Firewall Controller{% endblock %}

{% block extra_css %}
 <link rel="stylesheet" href="{{ url_for('static', filename='css/whitelist.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="whitelist-hero">
    <div class="whitelist-hero-content">
        <div class="row align-items-center">
            <div class="col-12">
                <h1 class="display-5 fw-bold mb-3">
                    <i class="fas fa-list me-3"></i>
                    Whitelist Management
                </h1>
                <p class="lead mb-0">
                    Manage trusted domains, IPs, URLs, and other resources allowed to bypass firewall restrictions
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body text-center p-4">
                <div class="stats-icon success mx-auto">
                    <i class="fas fa-list"></i>
                </div>
                <div class="stats-number text-success" id="totalItemsCount">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="stats-label">Total Items</div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body text-center p-4">
                <div class="stats-icon info mx-auto">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stats-number text-success" id="activeItemsCount">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="stats-label">Active Items</div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body text-center p-4">
                <div class="stats-icon primary mx-auto">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="stats-number text-primary" id="domainsCount">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="stats-label">Domains</div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body text-center p-4">
                <div class="stats-icon warning mx-auto">
                    <i class="fas fa-network-wired"></i>
                </div>
                <div class="stats-number text-info" id="ipsCount">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="stats-label">IP Addresses</div>
            </div>
        </div>
    </div>
</div>

<!-- Add Items Section -->
<div class="add-items-section">
    <div class="row">
        <div class="col-lg-2 col-md-4 col-6 mb-3">
            <div class="add-item-card" data-type="domain">
                <div class="type-badge domain">Domain</div>
                <div class="add-item-icon">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="add-item-title">Add Domain</div>
                <div class="add-item-desc">example.com<br>*.subdomain.com</div>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-3">
            <div class="add-item-card" data-type="ip">
                <div class="type-badge ip">IP Address</div>
                <div class="add-item-icon">
                    <i class="fas fa-network-wired"></i>
                </div>
                <div class="add-item-title">Add IP</div>
                <div class="add-item-desc">192.168.1.100<br>10.0.0.0/24</div>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-3">
            <div class="add-item-card" data-type="url">
                <div class="type-badge url">URL</div>
                <div class="add-item-icon">
                    <i class="fas fa-link"></i>
                </div>
                <div class="add-item-title">Add URL</div>
                <div class="add-item-desc">https://api.com/v1/*<br>/api/webhooks/*</div>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-3">
            <div class="add-item-card" data-type="port">
                <div class="type-badge port">Port</div>
                <div class="add-item-icon">
                    <i class="fas fa-door-open"></i>
                </div>
                <div class="add-item-title">Add Port</div>
                <div class="add-item-desc">80, 443<br>8000-9000</div>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-3">
            <div class="add-item-card" data-type="process">
                <div class="type-badge process">Process</div>
                <div class="add-item-icon">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="add-item-title">Add Process</div>
                <div class="add-item-desc">chrome.exe<br>node.exe</div>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-3">
            <div class="add-item-card" data-type="bulk">
                <div class="type-badge domain">Bulk Import</div>
                <div class="add-item-icon">
                    <i class="fas fa-upload"></i>
                </div>
                <div class="add-item-title">Bulk Add</div>
                <div class="add-item-desc">Import multiple<br>items at once</div>
            </div>
        </div>
    </div>
</div>

<!-- Search and Filter -->
<div class="card search-card">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text bg-light border-end-0">
                        <i class="fas fa-search text-muted"></i>
                    </span>
                    <input type="text" class="form-control border-start-0" 
                           placeholder="Search whitelist items..." 
                           id="item-search">
                </div>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="type-filter">
                    <option value="">All Types</option>
                    <option value="domain">Domains</option>
                    <option value="ip">IP Addresses</option>
                    <option value="url">URLs</option>
                    <option value="port">Ports</option>
                    <option value="process">Processes</option>
                </select>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="status-filter">
                    <option value="">All Status</option>
                    <option value="active">Active Only</option>
                    <option value="inactive">Inactive Only</option>
                </select>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="scope-filter">
                    <option value="">All Scopes</option>
                    <option value="global">Global</option>
                    <option value="agent">Agent Specific</option>
                </select>
            </div>
            <div class="col-md-2">
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-success flex-fill" id="refreshBtn">
                        <i class="fas fa-sync-alt me-1"></i>Refresh
                    </button>
                    <button class="btn btn-outline-primary" id="bulkActionsBtn">
                        <i class="fas fa-tasks me-1"></i>Bulk
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Actions (Hidden by default) -->
<div class="bulk-actions" id="bulkActions">
    <div class="row align-items-center">
        <div class="col-md-8">
            <span class="fw-semibold text-muted">
                <span id="selectedCount">0</span> items selected
            </span>
        </div>
        <div class="col-md-4 text-end">
            <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-danger" id="bulkDeleteBtn">
                    <i class="fas fa-trash me-1"></i>Delete
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Items List -->
<div class="card">
    <div class="card-header bg-light">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h6 class="mb-0 fw-bold">
                    <i class="fas fa-shield-alt me-2"></i>Whitelist Items
                </h6>
            </div>
            <div class="col-md-6 text-end">
                <small class="text-muted">
                    <span id="itemCount">Loading...</span> items configured
                </small>
            </div>
        </div>
    </div>
    <div class="card-body p-0">
        <div id="itemsContainer">
            <div class="text-center py-5">
                <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Loading items...</span>
                </div>
                <p class="mt-2 text-muted">Loading whitelist items...</p>
            </div>
        </div>
    </div>
</div>

<!-- Universal Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 15px; border: none;">
            <div class="modal-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border-radius: 15px 15px 0 0;">
                <h5 class="modal-title" id="modalTitle">
                    <i class="fas fa-plus-circle me-2"></i>Add Item to Whitelist
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form id="addItemForm">
                    <input type="hidden" name="item_type" id="itemType">
                    
                    <div class="mb-3">
                        <label class="form-label fw-semibold" id="valueLabel">Value</label>
                        <input type="text" class="form-control" name="value" id="valueInput" required>
                        <div class="form-text" id="valueHelp">
                            <i class="fas fa-info-circle me-1"></i>
                            <span id="valueExample">Enter the value</span>
                        </div>
                        <div class="input-example" id="inputExample"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Scope</label>
                        <select class="form-select" name="scope" id="scopeSelect">
                            <option value="global">Global (All Agents)</option>
                            <option value="agent">Agent Specific</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="agentSelectGroup" style="display: none;">
                        <label class="form-label fw-semibold">Target Agent</label>
                        <select class="form-select" name="agent_id">
                            <option value="">Select an agent...</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Description</label>
                        <textarea class="form-control" name="description" rows="3" 
                                  placeholder="Optional description for this item"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Notes</label>
                        <textarea class="form-control" name="notes" rows="2" 
                                  placeholder="Optional notes for this item"></textarea>
                    </div>
                    
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="active" id="activeCheck" checked>
                        <label class="form-check-label" for="activeCheck">
                            Enable this item immediately
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="addItemSubmitBtn">
                    <i class="fas fa-plus me-2"></i>Add Item
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Import Modal -->
<div class="modal fade" id="bulkImportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 15px; border: none;">
            <div class="modal-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border-radius: 15px 15px 0 0;">
                <h5 class="modal-title">
                    <i class="fas fa-upload me-2"></i>Bulk Import Whitelist Items
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="fw-bold mb-3">Import Methods</h6>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="importMethod" id="textImport" value="text" checked>
                                <label class="form-check-label" for="textImport">
                                    <i class="fas fa-edit me-1"></i> Paste Text
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="importMethod" id="fileImport" value="file">
                                <label class="form-check-label" for="fileImport">
                                    <i class="fas fa-file-upload me-1"></i> Upload File
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="fw-bold mb-3">Supported Formats</h6>
                        <small class="text-muted">
                            • One item per line<br>
                            • Domains: example.com<br>
                            • IPs: 192.168.1.1<br>
                            • URLs: https://api.com/v1<br>
                            • Ports: 80, 443, 8000-9000<br>
                            • Processes: chrome.exe
                        </small>
                    </div>
                </div>
                
                <div id="textImportSection">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Paste Items (one per line)</label>
                        <textarea class="form-control" id="bulkTextarea" rows="8" 
                                  placeholder="example.com&#10;192.168.1.100&#10;https://api.example.com&#10;80&#10;chrome.exe"></textarea>
                    </div>
                </div>
                
                <div id="fileImportSection" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Upload File</label>
                        <input type="file" class="form-control" id="bulkFile" accept=".txt,.csv">
                        <div class="form-text">Supported formats: .txt, .csv</div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Default Type</label>
                            <select class="form-select" id="bulkType">
                                <option value="auto">Auto-detect</option>
                                <option value="domain">Domain</option>
                                <option value="ip">IP Address</option>
                                <option value="url">URL</option>
                                <option value="port">Port</option>
                                <option value="process">Process</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Scope</label>
                            <select class="form-select" id="bulkScope">
                                <option value="global">Global (All Agents)</option>
                                <option value="agent">Agent Specific</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="bulkImportBtn">
                    <i class="fas fa-upload me-2"></i>Import Items
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/whitelist.js') }}"></script>
{% endblock %}